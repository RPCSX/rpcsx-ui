import React, { useEffect } from "react";
import { useWindowDimensions, StyleSheet } from "react-native";
import { useSharedValue, withSequence, withTiming, withRepeat, useDerivedValue, Easing, } from "react-native-reanimated";
import { Canvas, Fill, Path, Circle, BlurMask, LinearGradient, Skia, vec, Group, interpolateColors } from "@shopify/react-native-skia";

const X_ICON_PATH = 'm19.27 5.2773h0.13672l0.023438 0.007812 0.027343 0.027344 0.007813 0.015625v0.050781l-0.007813 0.015625-0.027343 0.042969-0.023438 0.015625-0.0625 0.078125-0.11719 0.12891c-0.019531 0.023438-0.039062 0.042969-0.058593 0.066406-0.046875 0.054688-0.097657 0.11328-0.14844 0.16406-0.058593 0.074219-0.12109 0.14062-0.18359 0.21094-0.011719 0.015626-0.027344 0.035157-0.042969 0.050782-0.074219 0.078125-0.14453 0.15625-0.21484 0.23828-0.023437 0.023437-0.042969 0.050781-0.066406 0.078125-0.046875 0.0625-0.10156 0.125-0.15625 0.17969l-0.050781 0.050781c-0.039063 0.042969-0.074219 0.082031-0.10938 0.125-0.082031 0.10547-0.17187 0.21094-0.26562 0.30859l-0.03125 0.03125-0.007813 0.011719h-0.011719l-0.015625 0.03125c-0.011719 0.011719-0.023437 0.023438-0.035156 0.035157-0.042969 0.046874-0.085937 0.09375-0.125 0.14453-0.035156 0.039062-0.070313 0.074219-0.10938 0.11328-0.039062 0.054688-0.082031 0.10547-0.12891 0.15234-0.074219 0.078125-0.14844 0.16016-0.21484 0.24609l-0.050781 0.058593c-0.015625 0.015625-0.03125 0.035157-0.042969 0.050781-0.097656 0.10156-0.19141 0.20703-0.28125 0.31641l-0.11719 0.12891-0.078124 0.089844c-0.011719 0.011719-0.023438 0.027343-0.035157 0.042969l-0.007812 0.011718-0.09375 0.09375c-0.023438 0.023438-0.039063 0.050782-0.058594 0.074219-0.050781 0.066406-0.10547 0.12891-0.16797 0.1875l-0.085937 0.09375c-0.035157 0.039063-0.070313 0.074219-0.10156 0.11719l-0.070312 0.085938c-0.078125 0.078125-0.15625 0.16406-0.22656 0.25l-0.097656 0.10938c-0.042969 0.050781-0.085937 0.10156-0.13281 0.15234l-0.09375 0.10156-0.019531 0.027344-0.007812 0.015625c-0.050781 0.058594-0.097657 0.11719-0.15234 0.17188l-0.015625 0.015625h-0.011719l-0.007812 0.015625-0.007813 0.011719c-0.015625 0.015625-0.027344 0.03125-0.042968 0.046875-0.007813 0.007812-0.015626 0.015625-0.023438 0.027343l-0.011719 0.007813-0.082031 0.09375c-0.066406 0.082031-0.14062 0.16406-0.21484 0.24609-0.042968 0.050781-0.085937 0.10156-0.12891 0.14844l-0.09375 0.10156-0.023438 0.03125-0.007812 0.011719c-0.046875 0.054687-0.09375 0.10937-0.14453 0.16016-0.050781 0.070312-0.10938 0.13281-0.17188 0.19531l-0.09375 0.10156-0.074219 0.078125-0.078125 0.10156c-0.035156 0.035156-0.070312 0.070313-0.10156 0.10938l-0.085938 0.10156c-0.078125 0.078125-0.14844 0.16016-0.21484 0.24609l-0.050781 0.054687-0.046875 0.050781c-0.042969 0.046875-0.085938 0.09375-0.12891 0.14453l-0.011719 0.007812-0.007813 0.015625-0.007812 0.011719v0.015625l0.015625 0.015625 0.011719 0.019531 0.066406 0.074219 0.09375 0.10156 0.066406 0.078125 0.046875 0.066407c0.050781 0.050781 0.097657 0.10156 0.14062 0.15625 0.046875 0.050781 0.09375 0.10547 0.13672 0.16016 0.046875 0.050781 0.09375 0.10547 0.13672 0.16016 0.046875 0.050781 0.09375 0.10156 0.13672 0.15625l0.085938 0.09375 0.074219 0.082031 0.042969 0.058594 0.078124 0.085937c0.046876 0.050782 0.09375 0.10156 0.13672 0.15625 0.019531 0.023438 0.039063 0.050782 0.058594 0.074219l0.09375 0.10156 0.066406 0.078125 0.050781 0.058593c0.046876 0.050782 0.09375 0.10156 0.13672 0.16016 0.046875 0.046875 0.09375 0.10156 0.13672 0.15625 0.046875 0.050781 0.09375 0.10547 0.13672 0.16016 0.046875 0.050781 0.09375 0.10156 0.13672 0.16016 0.046874 0.050781 0.09375 0.10547 0.13672 0.16406 0.050782 0.050781 0.09375 0.10547 0.13672 0.16016 0.050781 0.046875 0.09375 0.097656 0.13672 0.14844 0.019531 0.027343 0.039062 0.050781 0.058594 0.074218l0.09375 0.10156 0.066406 0.078125 0.050781 0.066406c0.046875 0.050781 0.09375 0.10156 0.13672 0.15625 0.046875 0.050781 0.09375 0.10547 0.13672 0.16016 0.046876 0.050782 0.09375 0.10547 0.13672 0.16016 0.050781 0.050782 0.09375 0.10156 0.13672 0.15625 0.050781 0.050782 0.09375 0.10547 0.13672 0.16016 0.050781 0.050781 0.09375 0.10547 0.13672 0.16016 0.050781 0.050781 0.097656 0.10156 0.14062 0.15625 0.046876 0.050781 0.09375 0.10547 0.13672 0.16016 0.046875 0.050781 0.09375 0.10547 0.13672 0.16016 0.046875 0.050781 0.09375 0.10156 0.13672 0.15625 0.046875 0.050781 0.09375 0.10547 0.13672 0.16016 0.046874 0.050781 0.09375 0.10547 0.13672 0.16016 0.050782 0.050781 0.09375 0.10156 0.13672 0.15625l0.085937 0.09375 0.074219 0.082031 0.042969 0.058594 0.074219 0.085937c0.050781 0.050782 0.097656 0.10547 0.14453 0.16406 0.046875 0.050781 0.09375 0.10547 0.13672 0.16016 0.046875 0.050781 0.09375 0.10156 0.13672 0.16016l0.085937 0.10156c0.011719 0.011719 0.023437 0.023438 0.035156 0.035156l0.015625 0.019532 0.015625 0.03125v0.070312l-0.007812 0.015625-0.015625 0.027344-0.007813 0.015625-0.019531 0.023437-0.03125 0.019531-0.011719 0.007813-0.015625 0.007813h-0.28125-0.67188-0.042969c-0.39844-0.003907-0.79687-0.003907-1.1914 0l-0.03125 0.007812c-0.011718-0.003906-0.027344-0.007812-0.042968-0.007812h-0.019532l-0.035156-0.015626-0.039062-0.027343-0.007813-0.007813-0.011719-0.015625-0.007812-0.015625-0.015625-0.003906c-0.050781-0.058594-0.097657-0.11328-0.14453-0.17578l-0.078126-0.085938-0.10937-0.12109-0.09375-0.10156c-0.007813-0.011719-0.015626-0.019531-0.019532-0.03125l-0.007812-0.011719c-0.027344-0.027344-0.054688-0.054687-0.082032-0.082031-0.019531-0.023437-0.042968-0.050781-0.0625-0.078125l-0.10937-0.12109-0.09375-0.10156c-0.007813-0.011719-0.015626-0.019532-0.023438-0.03125l-0.003906-0.011719c-0.027344-0.027344-0.054688-0.054687-0.082032-0.082031-0.023437-0.023438-0.042968-0.050782-0.0625-0.078125-0.050781-0.0625-0.10156-0.125-0.16016-0.17969l-0.10938-0.125c-0.078125-0.078125-0.15234-0.16016-0.22266-0.24609-0.070313-0.070313-0.13281-0.14453-0.19531-0.22266-0.023437-0.023437-0.042968-0.050781-0.066406-0.078125-0.058594-0.078125-0.125-0.14844-0.19141-0.21875l-0.023438-0.027344-0.007812-0.015624c-0.027344-0.027344-0.050781-0.050782-0.078125-0.078126-0.023437-0.027343-0.046875-0.050781-0.066406-0.078124l-0.10938-0.125-0.09375-0.10156c-0.003906-0.007813-0.011719-0.019531-0.019532-0.027344l-0.007812-0.015625-0.078125-0.078125c-0.023437-0.027343-0.046875-0.050781-0.066406-0.078125l-0.10938-0.125-0.09375-0.10156c-0.007813-0.007813-0.011719-0.019532-0.019532-0.027344l-0.007812-0.015625c-0.027344-0.027344-0.054688-0.054687-0.078125-0.078125-0.023437-0.027344-0.046875-0.054688-0.066406-0.082031-0.050781-0.0625-0.10156-0.12109-0.16016-0.17969l-0.10547-0.12109c-0.082032-0.078126-0.15625-0.16016-0.22656-0.24609-0.074219-0.078125-0.14844-0.16016-0.21484-0.24609-0.074219-0.078125-0.14453-0.16016-0.21094-0.24609-0.066406-0.066406-0.13281-0.14062-0.19531-0.21484-0.023438-0.027343-0.042969-0.050781-0.0625-0.078124-0.046876-0.058594-0.09375-0.11328-0.14453-0.16797l-0.015625-0.007813-0.015625 0.03125-0.0625 0.0625-0.015625 0.023438c-0.054687 0.066406-0.11328 0.13281-0.17188 0.19531l-0.046875 0.050782-0.11328 0.12891c-0.007812 0.007812-0.015625 0.019531-0.023438 0.027344h-0.011718l-0.015625 0.03125-0.042969 0.042968c-0.007812 0.007813-0.015625 0.019532-0.023438 0.027344l-0.011718 0.007812-0.042969 0.058594c-0.019531 0.015625-0.035156 0.03125-0.050781 0.050782-0.10156 0.10156-0.19531 0.21094-0.28125 0.32422-0.019532 0.015625-0.035156 0.035156-0.050782 0.050782-0.019531 0.019531-0.035156 0.042968-0.050781 0.0625-0.019531 0.023437-0.039062 0.046874-0.058593 0.066406-0.082032 0.082031-0.15625 0.16797-0.23047 0.25391-0.019531 0.023438-0.039063 0.046875-0.058594 0.070312-0.054687 0.070313-0.10938 0.13672-0.17188 0.19531l-0.10938 0.125-0.078125 0.085937c-0.015625 0.011719-0.027344 0.027344-0.039062 0.042969l-0.007813 0.015625c-0.054687 0.066406-0.10938 0.12891-0.17188 0.19141-0.011719 0.015626-0.027344 0.03125-0.042969 0.046876-0.011719 0.007812-0.023437 0.023437-0.035156 0.035156l-0.015625 0.019531c-0.046875 0.058594-0.097656 0.11719-0.15234 0.16797-0.007812 0.011718-0.015625 0.023437-0.019531 0.035156l-0.007813 0.007812h-0.015624l-0.007813 0.015626-0.007813 0.011718-0.042968 0.042969c-0.007813 0.011719-0.011719 0.019531-0.019532 0.03125l-0.015624 0.007813-0.042969 0.054687c-0.015625 0.019531-0.035157 0.035156-0.050781 0.050781-0.023438 0.027344-0.042969 0.054688-0.066407 0.082032l-0.042969 0.050781c-0.019531 0.023437-0.042968 0.046875-0.0625 0.070312l-0.09375 0.10938c-0.011718 0.007813-0.019531 0.019532-0.03125 0.027344l-0.007812 0.015625h-0.011719l-0.007812 0.015625-0.007813 0.011719c-0.015625 0.015625-0.027344 0.03125-0.042968 0.042969l-0.074219 0.089843-0.11328 0.12891c-0.019532 0.019531-0.039063 0.042968-0.058594 0.066406l-0.042969 0.046875c-0.023437 0.023437-0.042969 0.050781-0.066406 0.074219l-0.11328 0.12891c-0.019532 0.023437-0.039063 0.042968-0.058594 0.066406l-0.042969 0.050781c-0.023437 0.023438-0.042969 0.046875-0.066406 0.070313-0.050781 0.070312-0.10938 0.13672-0.17188 0.19531l-0.09375 0.10156-0.074219 0.085937-0.10547 0.125c-0.019531 0.019532-0.039062 0.042969-0.058594 0.0625l-0.050781 0.050782c-0.035156 0.042968-0.074219 0.085937-0.10938 0.13281l-0.042968 0.046875c-0.007813 0.011719-0.015626 0.019531-0.019532 0.03125l-0.039062 0.035156-0.011719 0.015625-0.023437 0.019532-0.027344 0.015624-0.039063 0.015626-0.0625 0.007812h-0.36328-0.12109-0.058594-0.63281-0.37891-0.011719c-0.14844-0.003906-0.30078-0.003906-0.44922 0h-0.019531l-0.042969-0.007812h-0.023437l-0.035157-0.015626-0.023437-0.015624-0.019531-0.019532-0.023438-0.035156-0.007812-0.015625v-0.09375l0.007812-0.015625c0.023438-0.03125 0.050782-0.0625 0.078125-0.09375l0.007813-0.015625c0.046875-0.042969 0.089844-0.09375 0.13281-0.14453l0.046875-0.0625c0.042969-0.054688 0.085938-0.10547 0.13281-0.15234 0.019531-0.023438 0.042968-0.046875 0.0625-0.070312 0.019531-0.027344 0.039062-0.050782 0.058594-0.074219l0.11719-0.13672 0.078125-0.085938 0.042969-0.058593c0.011719-0.011719 0.023437-0.023438 0.035156-0.035157 0.011719-0.011718 0.019531-0.023437 0.03125-0.039062l0.015625-0.019531h0.011719l0.015625-0.027344 0.015625-0.023437h0.011719l0.015624-0.027344c0.007813-0.015625 0.019532-0.027344 0.027344-0.039063l0.066406-0.070312c0.039063-0.050781 0.082032-0.097657 0.12891-0.14453 0.042969-0.054688 0.085937-0.10547 0.13281-0.15234 0.019531-0.027344 0.039063-0.054688 0.0625-0.078125 0.019531-0.023438 0.039063-0.046875 0.058594-0.074219l0.11719-0.13672 0.054688-0.0625 0.039062-0.039062 0.050782-0.0625 0.019531-0.023438 0.042969-0.050781 0.015625-0.015625 0.015625-0.027344c0.050781-0.058593 0.10547-0.12109 0.15625-0.17969l0.085937-0.10156c0.050781-0.054687 0.097657-0.10938 0.14453-0.16797 0.023438-0.027343 0.050782-0.054687 0.074219-0.085937l0.078125-0.085937c0.11719-0.14063 0.23828-0.28125 0.36328-0.41797l0.0625-0.078125 0.050781-0.058594c0.023437-0.023438 0.042969-0.046875 0.066406-0.074219 0.019531-0.027343 0.042969-0.050781 0.0625-0.078125 0.023437-0.023437 0.039063-0.046875 0.058594-0.074218l0.11719-0.13672 0.058594-0.0625 0.011719-0.015625 0.023437-0.023438 0.050782-0.0625 0.019531-0.023437 0.32031-0.36719 0.011719-0.027343c0.054688-0.0625 0.11328-0.12109 0.16797-0.18359 0.035156-0.042969 0.070312-0.089844 0.10938-0.13672l0.054687-0.0625 0.039063-0.039063 0.21484-0.25 0.015624-0.03125c0.16406-0.19531 0.33203-0.38672 0.50391-0.57812l0.066406-0.078126 0.050781-0.058593c0.019532-0.023438 0.042969-0.046875 0.0625-0.070313 0.023438-0.027344 0.042969-0.054687 0.066406-0.078125 0.019532-0.023437 0.039063-0.050781 0.058594-0.074219l0.11328-0.13672 0.066406-0.074219 0.007812-0.003906c0.039063-0.042969 0.078125-0.089844 0.11328-0.13281 0.007812-0.007812 0.015624-0.019531 0.023437-0.027344l0.007813-0.015624 0.015624-0.007813 0.003907-0.011719v-0.015625l-0.019531-0.035156c-0.023438-0.023437-0.042969-0.046875-0.066407-0.066406-0.0625-0.074219-0.12891-0.14844-0.20312-0.21484-0.023437-0.03125-0.046875-0.058594-0.070312-0.089844l-0.078125-0.085937c-0.019531-0.019532-0.035157-0.039063-0.050781-0.054688l-0.066407-0.066406c-0.007812-0.015625-0.019531-0.03125-0.027343-0.042969l-0.074219-0.082031-0.078125-0.085938c-0.023438-0.023437-0.042969-0.046874-0.066406-0.070312l-0.058594-0.058594c-0.023438-0.027344-0.046875-0.058594-0.070313-0.085937l-0.078125-0.085938c-0.019531-0.019531-0.035156-0.039062-0.050781-0.058593l-0.066406-0.066407c-0.007813-0.011719-0.019531-0.027343-0.027344-0.042969l-0.074219-0.078124-0.078125-0.085938c-0.023437-0.023438-0.042969-0.050781-0.066406-0.074219l-0.058594-0.058593c-0.023437-0.027344-0.046875-0.054688-0.070312-0.085938l-0.078125-0.085938c-0.019532-0.019531-0.035156-0.039062-0.050782-0.058593l-0.066406-0.0625c-0.007812-0.015625-0.019531-0.03125-0.027344-0.046875l-0.074218-0.078125-0.078125-0.085938c-0.023438-0.023437-0.042969-0.046875-0.066407-0.074219l-0.058593-0.054687c-0.023438-0.03125-0.046875-0.058594-0.070313-0.085937l-0.078125-0.089844c-0.019531-0.019532-0.035156-0.039063-0.050781-0.054688l-0.13281-0.14062c-0.007813-0.011719-0.019532-0.027343-0.027344-0.042969l-0.074219-0.078124-0.078125-0.085938c-0.023438-0.023438-0.042969-0.046875-0.066406-0.074219-0.035156-0.039062-0.070313-0.082031-0.10547-0.12109l-0.082031-0.085938c-0.019532-0.023438-0.042969-0.050781-0.0625-0.074219l-0.058594-0.058593c-0.023438-0.027344-0.046875-0.054688-0.070312-0.085938l-0.082032-0.085938c-0.015625-0.019531-0.03125-0.039062-0.050781-0.058593l-0.0625-0.0625c-0.011719-0.015625-0.019531-0.03125-0.03125-0.042969l-0.070313-0.082031-0.082031-0.085938c-0.019531-0.023437-0.042969-0.046875-0.0625-0.070312l-0.058593-0.058594c-0.023438-0.027344-0.046876-0.058594-0.074219-0.085937l-0.078125-0.089844c-0.015625-0.015625-0.03125-0.035156-0.050782-0.054688l-0.0625-0.066406c-0.011718-0.015625-0.019531-0.027344-0.03125-0.042969l-0.070312-0.078125-0.082031-0.089844c-0.019531-0.023437-0.042969-0.046874-0.0625-0.070312l-0.058594-0.058594c-0.023437-0.027344-0.046875-0.058594-0.074219-0.085937-0.011718-0.015625-0.027344-0.035157-0.042968-0.050781l-0.019532-0.015626c-0.011718-0.011718-0.019531-0.027343-0.03125-0.042968l-0.046875-0.050782-0.023437-0.027343v-0.015625l-0.007813-0.027344v-0.050781l0.015625-0.03125 0.015625-0.027344 0.019531-0.019531 0.027344-0.023438 0.039063-0.015625h0.41016 0.17969 1.1406 0.15234 0.16016 0.09375c0.042968 0.011719 0.085937 0.023438 0.12891 0.039063l0.074218 0.035156c0.019532 0.015625 0.039063 0.03125 0.054688 0.050781l0.074219 0.0625c0.015625 0.03125 0.042969 0.050781 0.0625 0.074219l0.066406 0.070312 0.085937 0.089844 0.085938 0.09375 0.074219 0.0625 0.085937 0.10156 0.074219 0.066406 0.085937 0.10156 0.070313 0.0625 0.085937 0.10156 0.074219 0.066406 0.085938 0.10156 0.074219 0.0625 0.085937 0.10156 0.070313 0.066407 0.085937 0.10156 0.074219 0.0625 0.085937 0.10156 0.078125 0.078126 0.066406 0.074218 0.085938 0.085938 0.09375 0.10156 0.066406 0.066406 0.070313 0.078126 0.082031 0.078124 0.09375 0.10156 0.0625 0.066406 0.074219 0.078125 0.078125 0.078125 0.09375 0.10156 0.074218 0.066406 0.085938 0.10156 0.070312 0.066407 0.089844 0.097656 0.070313 0.066406 0.078125 0.085938 0.050781 0.058593 0.066406 0.066407 0.015625 0.011719 0.011719 0.015624 0.007813 0.015626h0.015624l0.015626-0.007813c0.011718-0.015625 0.027343-0.027344 0.042968-0.042969l0.019532-0.023437 0.007812-0.011719 0.058594-0.058594c0.10938-0.11719 0.21484-0.23438 0.31641-0.35547 0.17578-0.18359 0.34766-0.37109 0.51172-0.5625 0.125-0.14453 0.25391-0.28516 0.38281-0.41797 0.082031-0.089844 0.16406-0.17578 0.24609-0.26172 0.023437-0.023438 0.042969-0.046875 0.066406-0.070312l0.085938-0.09375c0.023437-0.023438 0.042969-0.050782 0.066406-0.074219 0.10547-0.12109 0.21094-0.24219 0.32422-0.35938 0.050781-0.054688 0.10156-0.10547 0.15234-0.16016l0.070312-0.085938c0.015625-0.015625 0.03125-0.035156 0.042969-0.050781 0.0625-0.074219 0.12891-0.14453 0.19531-0.21094 0.015625-0.015625 0.035157-0.035156 0.050781-0.054687l0.015626-0.007813 0.035156-0.050781 0.16797-0.17188c0.015626-0.023437 0.03125-0.042969 0.046876-0.058594l0.058593-0.066406 0.074219-0.078125c0.007812-0.011719 0.019531-0.019531 0.027344-0.03125l0.007812-0.011719h0.015625l0.011719-0.03125 0.023438-0.019531 0.050781-0.058594c0.046875-0.054687 0.09375-0.10938 0.14453-0.16016l0.10938-0.10547 0.035156-0.046875 0.11328-0.097656 0.066407-0.058594 0.10938-0.10156c0.019531-0.015625 0.039062-0.027344 0.058594-0.042969l0.14844-0.125 0.015625-0.011719 0.40625-0.27734 0.011719-0.011718c0.44141-0.26172 0.91406-0.46484 1.4102-0.60156 0.12891-0.042969 0.25781-0.070312 0.39062-0.09375l0.019531-0.007812c0.16016-0.027344 0.3125-0.042969 0.47656-0.054688h0.015625c0.11328-0.015625 0.23828-0.023437 0.35156-0.023437z';

function round4(value: number) {
    'worklet'
    return Math.round(value * 10000) / 10000;
}

function round3(value: number) {
    'worklet'
    return Math.round(value * 1000) / 1000;
}

export const RPCSXBackground = () => {
    const progressValue = useSharedValue(0);
    const { width, height } = useWindowDimensions();

    useEffect(() => {
        progressValue.value = withSequence(
            withTiming(1, { duration: 6000, easing: Easing.bezier(0, 0.4, 0.2, 1.0) }),
            withRepeat(
                withSequence(
                    withTiming(0, { duration: 0 }),
                    withTiming(1, { duration: 120000, easing: Easing.linear }),
                ),
                -1,
                true
            ));
    }, []);

    const progress = useDerivedValue(() => round4(progressValue.value), [progressValue])

    const particleCount = 30;
    const particles = React.useMemo(() =>
        Array.from({ length: particleCount }).map((_, i) => {
            const angle = (i / particleCount) * Math.PI * 2;
            const radius = Math.random() * (width / 2) + (height / 3);
            return {
                id: i,
                startX: width / 2 + Math.cos(angle) * radius,
                startY: height / 2 + Math.sin(angle) * radius,
                endX: width / 2,
                endY: height / 2,
                size: Math.random() * 10 + 2,
                delay: Math.random(),
                orbitRadius: Math.random() * 150 + 50,
                orbitSpeed: Math.random() * 2 + 1,
            };
        }), [width, height, particleCount]
    );

    const waveCount = 2;
    const waves = React.useMemo(() =>
        Array.from({ length: waveCount }).map((_, i) => ({
            id: i,
            amplitude: 40 + i * 15,
            frequency: 0.008 - i * 0.002,
            phase: i * Math.PI / 3,
            opacity: 0.4 - i * 0.03,
        })), [waveCount]
    );

    const crossPath = React.useMemo(() => {
        const path = Skia.Path.MakeFromSVGString(X_ICON_PATH);
        if (!path) return null;

        const targetSize = Math.min(width, height) * 0.9;
        const scale = targetSize / 24;
        path.transform(Skia.Matrix().scale(scale, scale));
        const bounds = path.getBounds();
        path.transform(Skia.Matrix().translate(
            width / 2 - (bounds.x + bounds.width / 2),
            height / 2 - (bounds.y + bounds.height / 2),
        ));
        return path;
    }, [width, height]);

    return (
        <Canvas style={StyleSheet.absoluteFillObject}>
            <Fill>
                <LinearGradient
                    start={vec(0, 0)}
                    end={vec(width, height)}
                    colors={['#232a8bff', '#020733ff', '#585bf2ff']}
                />
            </Fill>

            <Group blendMode="hardLight">
                {waves.map((wave) => {
                    const animatedPath = useDerivedValue(() => {
                        const path = Skia.Path.Make();

                        const phase = progress.value * Math.PI * 2 + wave.phase;
                        let i = -100;
                        const y = height / 2;
                        path.moveTo(i, y + Math.sin(i * wave.frequency + phase) * wave.amplitude);

                        i += 30;

                        for (; i <= width + 100; i += 30) {
                            path.lineTo(i, y + Math.sin(i * wave.frequency + phase) * wave.amplitude);
                        }
                        return path;
                    }, [width, height, progress]);

                    return (
                        <Path
                            key={wave.id}
                            path={animatedPath}
                            style="stroke"
                            strokeWidth={height / 3}
                            color={`rgba(0, 0, 0, 255)`}
                            opacity={wave.opacity}
                        >
                            <LinearGradient
                                start={vec(0, 0)}
                                end={vec(width, height)}
                                colors={['#fff', '#6e7cf388', '#b5b6ffff', '#6e7cf388', '#fff', '#2c257aff']}
                            />
                        </Path>
                    );
                })}
            </Group>

            {particles.map((p) => {
                const animatedT = useDerivedValue(() => {
                    return round4((progress.value + p.delay) % 1);
                }, [progress]);

                const animatedOrbitAngle = useDerivedValue(() => {
                    return round3(animatedT.value * Math.PI * 2 * p.orbitSpeed);
                }, [animatedT]);

                const animatedOrbitAngleSin = useDerivedValue(() => {
                    return round3(Math.sin(animatedOrbitAngle.value));
                }, [animatedOrbitAngle]);

                const animatedOrbitRadius = useDerivedValue(() => {
                    return round3(p.orbitRadius * (1 - animatedT.value));
                }, [animatedT]);

                const animatedX = useDerivedValue(() => {
                    const baseX = p.startX + (p.endX - p.startX) * animatedT.value;
                    return baseX + Math.cos(animatedOrbitAngle.value) * animatedOrbitRadius.value;
                }, [animatedOrbitAngle, animatedT, animatedOrbitRadius]);

                const animatedY = useDerivedValue(() => {
                    const baseY = p.startY + (p.endY - p.startY) * animatedT.value;
                    return baseY + animatedOrbitAngleSin.value * animatedOrbitRadius.value;
                }, [animatedOrbitAngleSin, animatedT]);

                const animatedSize = useDerivedValue(() => {
                    return animatedOrbitAngleSin.value * p.size * (1 - animatedT.value) + 4;
                }, [animatedOrbitAngleSin, animatedT]);

                const animatedOpacity = useDerivedValue(() => {
                    // Fade in and out
                    if (animatedT.value < 0.1) return animatedT.value * 10;
                    if (animatedT.value > 0.9) return (1 - animatedT.value) * 10;
                    return 1;
                }, [animatedT]);

                const animatedBlur = useDerivedValue(() => {
                    return (1 - animatedT.value) * 6;
                }, [animatedT]);

                const animatedColor = useDerivedValue(() => {
                    return interpolateColors(
                        (0.5 - (animatedT.value * p.orbitSpeed) % 1),
                        [-0.5, 0.5],
                        ["#12a0f3b8", "#fff"]
                    );
                }, [animatedT]);


                return (
                    <Circle
                        key={p.id}
                        cx={animatedX}
                        cy={animatedY}
                        r={animatedSize}
                        color={animatedColor}
                        opacity={animatedOpacity}
                    ><BlurMask blur={animatedBlur} style="normal" /></Circle>
                );
            })}

            {crossPath && (
                <Path path={crossPath} color="#ffffff">
                    <BlurMask blur={1} style="normal" />
                </Path>
            )}
        </Canvas>
    );
};